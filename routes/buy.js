var Db=require("../db"),$=require("jquery-deferred"),Purchase=require("../controllers/purchase");module.exports={"default":{params:{type:{required:!0},id:{required:!0,parseMethod:parseInt}},handler:function(e,r){var s,a=r.type,u=r.id;if("gyms"===a||"exercises"===a)s=Db.getRefs()[a][u];else{var p=$.grep(Db.getRefs().shop,function(e){return e.name===a})[0];s=p.items[u]}var t={success:!1,purchase:{type:a,id:u,success:!1}},i=$.Deferred(),o=s.money||0,c=s.gold||0;return e.player["private"].gold<c||e.player["private"].money<o?(i.resolve(t),i):(c>0&&(e.player["private"].gold-=c,t.gold=-c),o>0&&(e.player["private"].money-=o,t.money=-o),t.success=t.purchase.success=!0,Purchase.go(e,a,u,t),e.isDirty=!0,i.resolve(t),i)}}};